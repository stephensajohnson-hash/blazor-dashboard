@page "/hsa"
@using Microsoft.AspNetCore.Components.Web
@rendermode @(new InteractiveServerRenderMode(prerender: false))

@* Keep these for when we add DB logic back later *@
@using Dashboard
@using Microsoft.EntityFrameworkCore
@inject IDbContextFactory<AppDbContext> DbFactory

<div class="min-h-screen bg-black flex flex-col items-center justify-center p-10 font-mono text-emerald-400">
    <h1 class="text-white text-2xl font-black mb-12 uppercase tracking-tighter border-b border-gray-800 pb-4 w-full max-w-2xl text-center">
        HSA Minimal Rebuild
    </h1>

    @* THE BUTTON *@
    <button @onclick="OpenModal" 
            class="bg-blue-600 hover:bg-blue-500 text-white px-16 py-8 rounded-3xl font-black text-2xl uppercase tracking-[0.3em] shadow-[0_0_50px_rgba(37,99,235,0.3)] transition-all active:scale-95">
        ADD RECEIPT
    </button>

    @* TERMINAL LOG CONSOLE *@
    <div class="mt-20 w-full max-w-2xl bg-gray-900 border border-gray-800 p-8 rounded-[2rem] h-96 overflow-y-auto shadow-2xl">
        <div class="text-gray-600 text-[10px] uppercase font-black mb-4 border-b border-gray-800 pb-2 flex justify-between">
            <span>Terminal Log</span>
            <span class="animate-pulse text-emerald-900">CIRCUIT_ALIVE</span>
        </div>
        @foreach (var log in logs)
        {
            <div class="mb-1 text-xs">
                <span class="text-gray-700">[@DateTime.Now.ToString("HH:mm:ss.fff")]</span> @log
            </div>
        }
    </div>
</div>

@* THE MODAL - Using the object pattern from your working budget-tracker *@
@if (tempObject != null)
{
    <div class="fixed inset-0 z-[9999] bg-black/95 flex items-center justify-center p-4">
        <div class="bg-[#111] border-4 border-blue-600 rounded-[3rem] p-20 w-full max-w-xl text-center shadow-[0_0_100px_rgba(0,0,0,1)]">
            <h2 class="text-white text-4xl font-black uppercase mb-12 tracking-widest">Modal Visible</h2>
            <button @onclick="Close" class="bg-white text-black px-12 py-4 rounded-full font-black uppercase text-sm tracking-[0.2em] hover:bg-gray-200 transition-all">
                CLOSE
            </button>
        </div>
    </div>
}

@code {
    private List<string> logs = new();
    private object? tempObject = null;

    protected override void OnInitialized()
    {
        AddLog("BOOT: Component initialized.");
    }

    private void OpenModal()
    {
        AddLog("EVENT: 'ADD RECEIPT' CLICKED.");
        
        // This instantiation triggers the @if block above
        tempObject = new object();
        
        AddLog("STATE: tempObject is NOT NULL.");
        StateHasChanged(); // Force the UI to refresh immediately
    }

    private void Close()
    {
        tempObject = null;
        AddLog("EVENT: MODAL CLOSED.");
        StateHasChanged();
    }

    private void AddLog(string msg)
    {
        logs.Insert(0, msg);
        // This will show up in your Render logs
        Console.WriteLine($"HSA_TERMINAL: {msg}");
    }
}