@page "/bullet-calendar"
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.AspNetCore.WebUtilities
@rendermode @(new InteractiveServerRenderMode(prerender: false))
@using Dashboard
@using Dashboard.Components.Bullet
@using Dashboard.Helpers
@using Dashboard.Services
@using Microsoft.EntityFrameworkCore
@using System.IO
@using Microsoft.JSInterop
@using System.Text.Json
@using System.Globalization
@inject AppDbContext Db
@inject BulletBaseService BaseService
@inject BulletTaskService TaskService
@inject BulletMeetingService MeetingService
@inject BulletHabitService HabitService
@inject BulletMediaService MediaService
@inject BulletHolidayService HolidayService
@inject BulletBirthdayService BirthdayService
@inject BulletAnniversaryService AnniversaryService
@inject BulletVacationService VacationService
@inject BulletHealthService HealthService
@inject BulletSportsService SportsService
@inject BulletOrchestratorService Orchestrator
@inject BulletNavigationService NavService
@inject BulletSearchService SearchService
@inject IJSRuntime JS
@inject NavigationManager Nav

<PageTitle>Calendar | Stephens' Dashboard</PageTitle>

<div class="min-h-screen bg-gray-900 text-white pb-40 relative font-sans">
Â  Â  
Â  Â  <div class="sticky top-0 z-40 bg-gray-900 border-b border-gray-800 shadow-2xl">
Â  Â  Â  Â  <BulletHeader 
Â  Â  Â  Â  Â  Â  ShowControls="true"
Â  Â  Â  Â  Â  Â  CustomDateText="@NavService.GetHeaderDateText()"
Â  Â  Â  Â  Â  Â  ActiveView="@NavService.CurrentView"
Â  Â  Â  Â  Â  Â  OnPrev="HandlePrev"
Â  Â  Â  Â  Â  Â  OnNext="HandleNext"
Â  Â  Â  Â  Â  Â  OnGoToday="HandleGoToday"
Â  Â  Â  Â  Â  Â  OnViewChanged="HandleSwitchView"
Â  Â  Â  Â  Â  Â  OnCloneRequest="HandleShowCloner">
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 ml-4 font-black">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative flex items-center bg-black/40 border border-gray-700 rounded-lg px-2 focus-within:border-blue-500 transition-all font-black shadow-inner">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <input @bind="SearchService.Query" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @bind:event="oninput" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @onkeyup="HandleKeyUp" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â placeholder="Search..." 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â class="bg-transparent border-none text-xs py-1.5 px-2 w-24 md:w-32 outline-none text-white font-black" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if (!string.IsNullOrEmpty(SearchService.Query))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="HandleClearSearch" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="p-1 text-gray-500 hover:text-red-400 transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M6 18L18 6M6 6l12 12" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="ToggleAdvancedSearch" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="p-1 text-gray-500 hover:text-blue-400 transition-colors" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  title="Advanced Filters">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6V4m0 2a2 2 0 100 4m0-4a2 2 0 110 4m-6 8a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4m6 6v10m6-2a2 2 0 100-4m0 4a2 2 0 110-4m0 4v2m0-6V4" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </svg>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <TemporalJumpGrid SelectedDate="NavService.ViewDate" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  UserId="userId" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  OnDateSelected="HandleGoToDate" />
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  </BulletHeader>
Â  Â  </div>

Â  Â  <div class="px-6 pt-4 font-black">
Â  Â  Â  Â  @if (SearchService.IsSearching)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  <div class="h-full flex flex-col font-black">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex justify-between items-center mb-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h2 class="text-sm font-black text-blue-400">Search Results (@SearchService.Results.Count)</h2>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if (SearchService.TotalPages > 1)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center gap-2 bg-black/40 px-2 py-1 rounded-lg border border-gray-800 shadow-xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="HandleSearchPrevPage" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled="@(SearchService.CurrentPage == 1)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="text-[10px] text-gray-400 hover:text-white disabled:opacity-30">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  PREV
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[10px] text-gray-600 font-black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Page @SearchService.CurrentPage of @SearchService.TotalPages
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="HandleSearchNextPage" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  disabled="@(SearchService.CurrentPage == SearchService.TotalPages)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="text-[10px] text-gray-400 hover:text-white disabled:opacity-30">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NEXT
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="HandleClearSearch" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="text-[10px] font-bold text-gray-400 hover:text-red-400 tracking-widest transition-colors">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Close Results
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  </div>

Â  Â  Â  Â  Â  Â  Â  Â  <div class="pb-20">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @foreach (var item in SearchService.GetPagedResults()) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="h-full border border-gray-800 rounded-xl overflow-hidden bg-gray-800/20 p-1 relative shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick="() => HandleGoToDate(item.Date)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @onclick:stopPropagation="true" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="absolute top-2 left-2 z-20 bg-blue-600 hover:bg-blue-500 text-[8px] font-black px-1.5 py-0.5 rounded shadow-lg cursor-pointer transition-colors border-none outline-none font-black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @item.Date.ToString("MMM dd, yyyy")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BulletItemSwitcher Item="item" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Mode="Card" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â User="currentUser" 
                                                   ShowControls="false"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnEdit="OpenEdit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnToggle="ToggleComplete" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnDelete="DeleteTask" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnCopyRequest="InitiateDeepCopy"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveUp="() => MoveItem(item, -1, true)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveDown="() => MoveItem(item, 1, true)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnHabitSave="SaveHabitDirectly" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (NavService.CurrentView == "day")
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-3 gap-6 font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  @foreach (var cat in new[] { ("Work", "work", "blue"), ("Personal", "personal", "green"), ("Health", "health", "orange") })
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-800/40 rounded-xl border border-gray-700 flex flex-col overflow-hidden shadow-2xl">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 bg-gray-800/80 border-b border-gray-700 flex justify-between items-center sticky top-0 backdrop-blur z-10 font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="font-bold text-@cat.Item3-400 tracking-wider text-sm font-black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @cat.Item1
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <button @onclick='async () => await OpenEditor(cat.Item2, cat.Item2 == "health" ? "health" : "task", NavService.ViewDate)' 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  class="text-xs bg-gray-700 hover:bg-white hover:text-black px-2 py-0.5 rounded transition font-bold tracking-widest shadow-md font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  ï¼‹ Add
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </button>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-3 space-y-3 font-bold font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if (cat.Item2 == "personal" && showGameBanner && !isLoading)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var favoriteGames = BulletDataLogic.GetFavoriteGamesForDate(_sports, teams, NavService.ViewDate);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  foreach (var game in favoriteGames)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var favTeam = teams.FirstOrDefault(t => t.IsFavorite && (t.Id == game.Detail.HomeTeamId || t.Id == game.Detail.AwayTeamId));
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-blue-600/20 border border-blue-500/50 rounded-lg flex items-stretch shadow-lg animate-pulse mb-4 overflow-hidden">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-black/40 flex items-center justify-center p-2 border-r border-blue-500/30" style="width: @BulletViewConfig.ImgWidthDay;">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if (!string.IsNullOrEmpty(favTeam?.LogoUrl)) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <img src="@favTeam.LogoUrl" class="w-full h-auto object-contain max-h-12" /> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-xl">ğŸ†</span> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex-1 p-2 flex flex-col justify-center min-w-0">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex items-center justify-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[9px] bg-blue-600 text-white px-1.5 py-0.5 rounded font-black tracking-widest uppercase">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Game Day
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if (game.Detail?.StartTime != null) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="text-[9px] text-blue-300 font-mono">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  â° @game.Detail.StartTime?.ToString("h:mm tt")
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </span> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-xs text-white font-black truncate mt-1">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span>@game.Title</span>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @if(isLoading) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-center text-gray-500 text-xs italic mt-4 animate-pulse tracking-widest font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Syncing...
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var dayItems = BulletDataLogic.GetItemsForColumn(loadedItems, NavService.ViewDate, cat.Item2);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var sortedItems = BulletDataLogic.GetSortedItems(dayItems);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  foreach(var item in sortedItems) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BulletItemSwitcher @key="@($"{item.Type}_{item.Id}")" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Item="item" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Mode="Card" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â User="currentUser" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnEdit="OpenEdit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnToggle="ToggleComplete" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnDelete="DeleteTask" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnCopyRequest="InitiateDeepCopy"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveUp="() => MoveItem(item, -1, true)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveDown="() => MoveItem(item, 1, true)" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnHabitSave="SaveHabitDirectly" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (NavService.CurrentView == "week")
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-7 gap-2 font-sans font-bold font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  @for(int i = 0; i < 7; i++) 
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var d = NavService.GetWeekStart().AddDays(i);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="flex flex-col rounded-xl border @GetDayBorderClass(d) overflow-hidden bg-gray-800/40 shadow-xl font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-2 text-center border-b border-gray-700/50 bg-gray-800/60 cursor-pointer hover:bg-gray-700 transition" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @onclick="() => HandleGoToDate(d)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-[10px] font-black text-gray-500 font-black ">@d.ToString("ddd")</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-lg font-black text-white font-black "><span>@d.Day</span></div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="p-1 space-y-1 font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var weekItems = BulletDataLogic.GetItemsForDate(loadedItems, d);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var sortedWeekItems = BulletDataLogic.GetSortedItems(weekItems);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @foreach(var item in sortedWeekItems) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BulletItemSwitcher @key="@($"{item.Type}_{item.Id}")" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Item="item" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Mode="Pill" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â User="currentUser" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnEdit="OpenEdit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnCopyRequest="InitiateDeepCopy"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveUp="HandlePillReorder" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveDown="HandlePillReorder" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (NavService.CurrentView == "month")
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  <div class="flex flex-col font-sans font-black font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-7 text-center pb-2 border-b border-gray-800 mb-2 text-[10px] text-gray-500 font-black ">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @foreach(var day in new[]{"Mon","Tue","Wed","Thu","Fri","Sat","Sun"})
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="font-black ">@day</div> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="grid grid-cols-7 gap-1 auto-rows-fr font-black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @for(int i = 0; i < GetMonthEmptyCells(); i++) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="bg-gray-900/30 rounded-lg h-32"></div> 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @for(int d = 1; d <= GetDaysInMonth(); d++)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var currentDay = new DateTime(NavService.ViewDate.Year, NavService.ViewDate.Month, d);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="relative flex flex-col rounded-lg border @GetDayBorderClass(currentDay) p-1 hover:bg-gray-800 transition cursor-pointer bg-gray-900/50 shadow-inner min-h-[120px] font-black " 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â @onclick="() => HandleGoToDate(currentDay)">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="text-right text-[10px] font-bold text-gray-500 mb-1 font-black ">@d</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="space-y-1 font-black">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @{
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var monthItems = BulletDataLogic.GetItemsForDate(loadedItems, currentDay);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var sortedMonthItems = BulletDataLogic.GetSortedItems(monthItems);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  @foreach(var item in sortedMonthItems) 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <BulletItemSwitcher @key="@($"{item.Type}_{item.Id}")" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Item="item" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â Mode="Pill" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â User="currentUser" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnEdit="OpenEdit" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnCopyRequest="InitiateDeepCopy"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveUp="HandlePillReorder" 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â OnMoveDown="HandlePillReorder" />
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  }
Â  Â  </div>

    @if (!string.IsNullOrEmpty(toastMessage))
    {
        <div class="fixed bottom-10 left-1/2 -translate-x-1/2 z-[100] bg-red-600/90 backdrop-blur text-white px-6 py-3 rounded-full shadow-2xl font-black border border-white/20">
            @toastMessage
        </div>
    }
</div>

<BulletSearchModal 
Â  Â  @bind-SearchStart="SearchService.Start" 
Â  Â  @bind-SearchEnd="SearchService.End" 
Â  Â  @bind-SearchType="SearchService.Type" 
Â  Â  IsVisible="showAdvancedSearch" 
Â  Â  OnClose="HideAdvancedSearch" 
Â  Â  OnSearchRequested="HandleExecuteAdvancedSearch" />

<BulletClonerModal 
Â  Â  IsVisible="showTemporalCloneModal" 
Â  Â  @bind-SourceYear="cloneSourceYear" 
Â  Â  @bind-TargetYear="cloneTargetYear" 
Â  Â  @bind-IncludeBirthdays="includeBirthdays" 
Â  Â  @bind-IncludeAnniversaries="includeAnniversaries" 
Â  Â  @bind-IncludeHolidays="includeHolidays" 
Â  Â  OnClose="HideCloner" 
Â  Â  OnCloneRequested="ExecuteClone" />

<BulletCopyModal 
Â  Â  IsVisible="showCopyModal" 
Â  Â  ItemType="@itemToCopy?.Type" 
Â  Â  OnCancel="() => showCopyModal = false" 
Â  Â  OnConfirm="ExecuteCopy" />

<BaseEditor Item="editingItem" 
Â  Â  Â  Â  Â  Â  TaskDetail="editingItem?.Detail ?? new()" 
Â  Â  Â  Â  Â  Â  MeetingDetail="editingItem?.MeetingDetail ?? new()"
Â  Â  Â  Â  Â  Â  BirthdayDetail="editingItem?.BirthdayDetail ?? new()"
Â  Â  Â  Â  Â  Â  HealthDetail="editingItem?.HealthDetail ?? new()"
Â  Â  Â  Â  Â  Â  HabitDetail="editingItem?.HabitDetail ?? new()"
Â  Â  Â  Â  Â  Â  MediaDetail="editingItem?.MediaDetail ?? new()"
Â  Â  Â  Â  Â  Â  HolidayDetail="editingItem?.HolidayDetail ?? new()"
Â  Â  Â  Â  Â  Â  AnniversaryDetail="editingItem?.AnniversaryDetail ?? new()"
Â  Â  Â  Â  Â  Â  VacationDetail="editingItem?.VacationDetail ?? new()"
Â  Â  Â  Â  Â  Â  SportsDetail="editingItem?.SportsDetail ?? new()"
Â  Â  Â  Â  Â  Â  Leagues="leagues"
Â  Â  Â  Â  Â  Â  Seasons="seasons"
Â  Â  Â  Â  Â  Â  Teams="teams"
Â  Â  Â  Â  Â  Â  Notes="editingItem?.Notes ?? new List<BulletItemNote>()"
Â  Â  Â  Â  Â  Â  OnSaveRecurring="HandleSave" 
Â  Â  Â  Â  Â  Â  OnCancel="CancelEditing" 
Â  Â  Â  Â  Â  Â  OnDelete="DeleteCurrentTask" />

@code {
Â  Â  #region State Variables

Â  Â  private User? currentUser;
Â  Â  private int userId = 0;
Â  Â  private bool isLoading = true;
Â  Â  private List<BulletTaskService.TaskDTO> loadedItems = new();

Â  Â  private List<League> leagues = new();
Â  Â  private List<Season> seasons = new();
Â  Â  private List<Team> teams = new();

Â  Â  private List<BulletMeetingService.MeetingDTO> _meetings = new();
Â  Â  private List<BulletBirthdayService.BirthdayDTO> _bdays = new();
Â  Â  private List<BulletVacationService.VacationDTO> _vacations = new();
Â  Â  private List<BulletHolidayService.HolidayDTO> _holidays = new();
Â  Â  private List<BulletAnniversaryService.AnniversaryDTO> _anniversaries = new();
Â  Â  private List<BulletMediaService.MediaDTO> _media = new();
Â  Â  private List<BulletSportsService.GameDTO> _sports = new();
Â  Â  private List<BulletHealthService.HealthDTO> loadedHealth = new();
Â  Â  private List<BulletHabitService.HealthDTO> loadedHabits = new();

Â  Â  private BulletTaskService.TaskDTO? editingItem;
Â  Â  private BulletTaskService.TaskDTO? itemToCopy;

Â  Â  private bool showAdvancedSearch = false;
Â  Â  private bool showGameBanner = false;
Â  Â  private bool showCopyModal = false;
    private string toastMessage = "";

Â  Â  private bool showTemporalCloneModal = false;
Â  Â  private int cloneSourceYear = DateTime.Today.Year;
Â  Â  private int cloneTargetYear = DateTime.Today.Year + 1;
Â  Â  private bool includeBirthdays = true;
Â  Â  private bool includeAnniversaries = true;
Â  Â  private bool includeHolidays = true;

Â  Â  private const int pageSize = 50;

Â  Â  #endregion

Â  Â  #region Lifecycle

Â  Â  protected override async Task OnAfterRenderAsync(bool firstRender)
Â  Â  {
Â  Â  Â  Â  if (firstRender)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  try
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  var json = await JS.InvokeAsync<string>("localStorage.getItem", "dashboard_session");
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  if (!string.IsNullOrEmpty(json))
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  using var doc = JsonDocument.Parse(json);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (doc.RootElement.TryGetProperty("UserId", out var p) || 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  doc.RootElement.TryGetProperty("userId", out p))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  userId = p.GetInt32();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (userId > 0)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentUser = await Db.Users.FindAsync(userId);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NavService.ClientOffsetMinutes = await JS.InvokeAsync<int>(
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "eval", 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  "new Date().getTimezoneOffset()"
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  );
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  var uri = Nav.ToAbsoluteUri(Nav.Uri);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  if (QueryHelpers.ParseQuery(uri.Query).TryGetValue("date", out var dVal) && 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  DateTime.TryParse(dVal, out var parsed))
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NavService.SetViewDate(parsed);
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  else
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  NavService.GoToday();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  leagues = await Db.Leagues.OrderBy(x => x.Name).ToListAsync() ?? new();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  seasons = await Db.Seasons.ToListAsync() ?? new();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  teams = await Db.Teams.ToListAsync() ?? new();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  await LoadData();
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  catch (Exception ex) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  await LogToConsole($"Init Fail: {ex.Message}"); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  finally 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  isLoading = false; 
Â  Â  Â  Â  Â  Â  Â  Â  StateHasChanged(); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  #endregion

Â  Â  #region Data Loading

Â  Â  private async Task LoadData()
Â  Â  {
Â  Â  Â  Â  if (currentUser == null)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  isLoading = true;
Â  Â  Â  Â  StateHasChanged();

Â  Â  Â  Â  DateTime s = DateTime.SpecifyKind(NavService.ViewDate.Date, DateTimeKind.Utc);
Â  Â  Â  Â  DateTime e = s.AddDays(1).AddSeconds(-1);

Â  Â  Â  Â  if (NavService.CurrentView == "week") 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  s = NavService.GetWeekStart(); 
Â  Â  Â  Â  Â  Â  e = s.AddDays(7).AddSeconds(-1); 
Â  Â  Â  Â  }
Â  Â  Â  Â  else if (NavService.CurrentView == "month") 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  s = new DateTime(NavService.ViewDate.Year, NavService.ViewDate.Month, 1); 
Â  Â  Â  Â  Â  Â  e = s.AddMonths(1).AddSeconds(-1); 
Â  Â  Â  Â  }

Â  Â  Â  Â  try
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  loadedItems.Clear();

Â  Â  Â  Â  Â  Â  loadedItems.AddRange(await TaskService.GetTasksForRange(userId, s, e));

Â  Â  Â  Â  Â  Â  _meetings = await MeetingService.GetMeetingsForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var m in _meetings) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapMeeting(m)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _bdays = await BirthdayService.GetBirthdaysForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var b in _bdays) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapBirthday(b)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _vacations = await VacationService.GetVacationsForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var v in _vacations) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapVacation(v)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _holidays = await HolidayService.GetHolidaysForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var h in _holidays) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapHoliday(h)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _anniversaries = await AnniversaryService.GetAnniversariesForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var a in _anniversaries) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapAnniversary(a)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _sports = await SportsService.GetGamesForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var g in _sports) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapGame(g)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  _media = await MediaService.GetMedia(userId);
Â  Â  Â  Â  Â  Â  foreach (var m in _media.Where(x => x.Date.Date >= s.Date && x.Date.Date <= e.Date)) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapMedia(m)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  loadedHealth = await HealthService.GetHealthItemsForRange(userId, s, e);
Â  Â  Â  Â  Â  Â  foreach (var h in loadedHealth) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapHealth(h)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  loadedHabits = await HabitService.GetHabits(userId);
Â  Â  Â  Â  Â  Â  foreach (var h in loadedHabits.Where(x => x.Date.Date >= s.Date && x.Date.Date <= e.Date)) 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  loadedItems.Add(BulletMapper.MapHabit(h)); 
Â  Â  Â  Â  Â  Â  }

Â  Â  Â  Â  Â  Â  if (BulletDataLogic.GetFavoriteGamesForDate(_sports, teams, NavService.ViewDate).Any())
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  showGameBanner = true;
Â  Â  Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  Â  Â  await Task.Delay(5000);
Â  Â  Â  Â  Â  Â  Â  Â  showGameBanner = false; 
Â  Â  Â  Â  Â  Â  Â  Â  StateHasChanged();
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  Â  Â  catch (Exception ex) 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  await LogToConsole($"Sync Error: {ex.Message}"); 
Â  Â  Â  Â  }

Â  Â  Â  Â  isLoading = false; 
Â  Â  Â  Â  StateHasChanged();
Â  Â  }

Â  Â  #endregion

Â  Â  #region Navigation Handlers

Â  Â  private async Task HandlePrev()
Â  Â  {
Â  Â  Â  Â  SearchService.IsSearching = false; 
Â  Â  Â  Â  NavService.MovePrev();
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  private async Task HandleNext()
Â  Â  {
Â  Â  Â  Â  SearchService.IsSearching = false; 
Â  Â  Â  Â  NavService.MoveNext();
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  private async Task HandleGoToday()
Â  Â  {
Â  Â  Â  Â  SearchService.ClearSearch(); 
Â  Â  Â  Â  NavService.GoToday();
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  private async Task HandleGoToDate(DateTime d)
Â  Â  {
Â  Â  Â  Â  SearchService.ClearSearch(); 
Â  Â  Â  Â  NavService.SetViewDate(d);
Â  Â  Â  Â  NavService.SetView("day");
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  private async Task HandleSwitchView(string view)
Â  Â  {
Â  Â  Â  Â  SearchService.IsSearching = false; 
Â  Â  Â  Â  NavService.SetView(view);
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  private int GetDaysInMonth()
Â  Â  {
Â  Â  Â  Â  return DateTime.DaysInMonth(NavService.ViewDate.Year, NavService.ViewDate.Month);
Â  Â  }

Â  Â  private int GetMonthEmptyCells()
Â  Â  {
Â  Â  Â  Â  var firstDay = new DateTime(NavService.ViewDate.Year, NavService.ViewDate.Month, 1);
Â  Â  Â  Â  return ((int)firstDay.DayOfWeek + 6) % 7;
Â  Â  }

Â  Â  private string GetDayBorderClass(DateTime date)
Â  Â  {
Â  Â  Â  Â  var today = DateTime.UtcNow.AddMinutes(-NavService.ClientOffsetMinutes).Date;
Â  Â  Â  Â  
Â  Â  Â  Â  if (date.Date == today)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return "border-yellow-500 shadow-lg";
Â  Â  Â  Â  }

Â  Â  Â  Â  return "border-gray-700";
Â  Â  }

Â  Â  #endregion

Â  Â  #region CRUD & Deep Copy

Â  Â  private async Task HandleSave(BaseEditor.RecurrenceRequest req)
Â  Â  {
Â  Â  Â  Â  if (editingItem == null) 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  }

Â  Â  Â  Â  try 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  await Orchestrator.CommitItemToDatabase(editingItem); 
Â  Â  Â  Â  Â  Â  editingItem = null; 
Â  Â  Â  Â  Â  Â  await LoadData(); 
Â  Â  Â  Â  }
Â  Â  Â  Â  catch (Exception ex) 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  await LogToConsole($"Save Error: {ex.Message}"); 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  private void InitiateDeepCopy(BulletTaskService.TaskDTO item)
Â  Â  {
Â  Â  Â  Â  itemToCopy = item;
Â  Â  Â  Â  showCopyModal = true;
Â  Â  }

Â  Â  private async Task ExecuteCopy((DateTime date, bool notes, bool todos, bool move) options)
Â  Â  {
Â  Â  Â  Â  if (itemToCopy == null) 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  try
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  await Orchestrator.DeepCloneItem(
Â  Â  Â  Â  Â  Â  Â  Â  itemToCopy, 
Â  Â  Â  Â  Â  Â  Â  Â  options.date, 
Â  Â  Â  Â  Â  Â  Â  Â  options.notes, 
Â  Â  Â  Â  Â  Â  Â  Â  options.todos,
Â  Â  Â  Â  Â  Â  Â  Â  options.move
Â  Â  Â  Â  Â  Â  );

Â  Â  Â  Â  Â  Â  showCopyModal = false;
Â  Â  Â  Â  Â  Â  itemToCopy = null;
Â  Â  Â  Â  Â  Â  await LoadData();
Â  Â  Â  Â  }
Â  Â  Â  Â  catch (Exception ex)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  await LogToConsole($"Copy Error: {ex.Message}");
Â  Â  Â  Â  }
Â  Â  }

Â  Â  private async Task DeleteTask(int id) 
Â  Â  { 
        var item = loadedItems.FirstOrDefault(x => x.Id == id) 
                   ?? SearchService.Results.FirstOrDefault(x => x.Id == id);
        
        var title = item?.Title ?? "Item";

        await BaseService.DeleteItem(id); 

        toastMessage = $"âœ• {title} deleted";
        StateHasChanged();

        if (SearchService.IsSearching)
        {
            await SearchService.ExecuteSearch(userId);
        }
        else
        {
            await LoadData(); 
        }

        _ = Task.Delay(2000).ContinueWith(_ => 
        {
            toastMessage = "";
            InvokeAsync(StateHasChanged);
        });
Â  Â  }

Â  Â  private async Task DeleteCurrentTask() 
Â  Â  { 
Â  Â  Â  Â  if (editingItem != null && editingItem.Id > 0)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  var confirmed = await JS.InvokeAsync<bool>("confirm", "Delete?");
Â  Â  Â  Â  Â  Â  
Â  Â  Â  Â  Â  Â  if (confirmed)
Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  await BaseService.DeleteItem(editingItem.Id); 
Â  Â  Â  Â  Â  Â  Â  Â  editingItem = null; 
Â  Â  Â  Â  Â  Â  Â  Â  await LoadData(); 
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }
Â  Â  }

Â  Â  private async Task ToggleComplete(BulletTaskService.TaskDTO t) 
Â  Â  { 
Â  Â  Â  Â  try 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  await Orchestrator.CommitItemToDatabase(t); 
Â  Â  Â  Â  } 
Â  Â  Â  Â  catch (Exception ex) 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  await LogToConsole($"Toggle Fail: {ex.Message}"); 
Â  Â  Â  Â  } 
Â  Â  }

Â  Â  private async Task SaveHabitDirectly(BulletHabitService.HabitDTO h) 
Â  Â  { 
Â  Â  Â  Â  await HabitService.SaveHabit(h); 
Â  Â  }

Â  Â  private async Task MoveItem(BulletTaskService.TaskDTO item, int direction, bool useCategory = false)
Â  Â  {
Â  Â  Â  Â  List<BulletTaskService.TaskDTO> list;

Â  Â  Â  Â  if (useCategory)
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  list = BulletDataLogic.GetSortedItems(BulletDataLogic.GetItemsForColumn(loadedItems, item.Date, item.Category));
Â  Â  Â  Â  }
Â  Â  Â  Â  else
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  list = BulletDataLogic.GetSortedItems(BulletDataLogic.GetItemsForDate(loadedItems, item.Date));
Â  Â  Â  Â  }

Â  Â  Â  Â  int currentIndex = list.FindIndex(x => x.Id == item.Id && x.Type == item.Type);
Â  Â  Â  Â  
Â  Â  Â  Â  if (currentIndex == -1) 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }

Â  Â  Â  Â  int newIndex = currentIndex + direction;
Â  Â  Â  Â  
Â  Â  Â  Â  if (newIndex < 0 || newIndex >= list.Count) 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  
Â  Â  Â  Â  var targetItem = list[newIndex];
Â  Â  Â  Â  
Â  Â  Â  Â  await Orchestrator.SwapSortOrders(item.Id, targetItem.Id, list);
Â  Â  Â  Â  await LoadData();
Â  Â  }

Â  Â  #endregion

Â  Â  #region Editor Handlers

Â  Â  private void CancelEditing() 
Â  Â  { 
Â  Â  Â  Â  editingItem = null; 
Â  Â  }

Â  Â  private void OpenEdit(BulletTaskService.TaskDTO t) 
Â  Â  { 
Â  Â  Â  Â  editingItem = BulletMapper.CreateCopy(t); 
Â  Â  Â  Â  
Â  Â  Â  Â  editingItem.Id = t.Id; 
Â  Â  Â  Â  editingItem.MeetingDetail ??= new(); 
Â  Â  Â  Â  editingItem.HabitDetail ??= new(); 
Â  Â  Â  Â  editingItem.MediaDetail ??= new(); 
Â  Â  Â  Â  editingItem.HolidayDetail ??= new(); 
Â  Â  Â  Â  editingItem.BirthdayDetail ??= new(); 
Â  Â  Â  Â  editingItem.AnniversaryDetail ??= new(); 
Â  Â  Â  Â  editingItem.VacationDetail ??= new(); 
Â  Â  Â  Â  editingItem.HealthDetail ??= new(); 
Â  Â  Â  Â  editingItem.SportsDetail ??= new(); 
Â  Â  Â  Â  editingItem.Notes ??= new List<BulletItemNote>(); 
Â  Â  Â  Â  editingItem.Todos ??= new List<BulletTaskTodoItem>(); 
Â  Â  }

Â  Â  private async Task OpenEditor(string category, string type, DateTime date) 
Â  Â  { 
Â  Â  Â  Â  await OpenNewEditor(category, type, date); 
Â  Â  }

Â  Â  private async Task OpenNewEditor(string cat, string type, DateTime targetDate) 
Â  Â  { 
Â  Â  Â  Â  var newItem = new BulletTaskService.TaskDTO 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  UserId = userId, 
Â  Â  Â  Â  Â  Â  Category = cat, 
Â  Â  Â  Â  Â  Â  Type = type, 
Â  Â  Â  Â  Â  Â  Date = targetDate, 
Â  Â  Â  Â  Â  Â  Detail = new(), 
Â  Â  Â  Â  Â  Â  HealthDetail = new(), 
Â  Â  Â  Â  Â  Â  MeetingDetail = new(), 
Â  Â  Â  Â  Â  Â  HabitDetail = new(), 
Â  Â  Â  Â  Â  Â  HolidayDetail = new(), 
Â  Â  Â  Â  Â  Â  BirthdayDetail = new(), 
Â  Â  Â  Â  Â  Â  AnniversaryDetail = new(), 
Â  Â  Â  Â  Â  Â  VacationDetail = new(), 
Â  Â  Â  Â  Â  Â  MediaDetail = new(), 
Â  Â  Â  Â  Â  Â  SportsDetail = new(), 
Â  Â  Â  Â  Â  Â  Notes = new List<BulletItemNote>(), 
Â  Â  Â  Â  Â  Â  Todos = new List<BulletTaskTodoItem>() 
Â  Â  Â  Â  }; 

Â  Â  Â  Â  if (type == "health") 
Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  try 
Â  Â  Â  Â  Â  Â  { 
Â  Â  Â  Â  Â  Â  Â  Â  var lastHealth = await Db.BulletHealthDetails.Include(d => d.BulletItem)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .Where(h => h.BulletItem.UserId == userId && h.BulletItem.Type == "health" && h.BulletItem.Date < targetDate)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .OrderByDescending(h => h.BulletItem.Date)
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  .FirstOrDefaultAsync(); 

Â  Â  Â  Â  Â  Â  Â  Â  if (lastHealth != null && lastHealth.WeightLbs > 0) 
Â  Â  Â  Â  Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  newItem.HealthDetail.WeightLbs = lastHealth.WeightLbs; 
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  } 
Â  Â  Â  Â  Â  Â  catch { } 
Â  Â  Â  Â  } 

Â  Â  Â  Â  editingItem = newItem; 
Â  Â  }

Â  Â  #endregion

Â  Â  #region Search Handlers

Â  Â  private async Task HandleKeyUp(KeyboardEventArgs e) 
Â  Â  { 
Â  Â  Â  Â  if (e.Key == "Enter") 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  await SearchService.ExecuteSearch(userId); 
Â  Â  Â  Â  }

Â  Â  Â  Â  if (e.Key == "Escape") 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  HandleClearSearch(); 
Â  Â  Â  Â  }
Â  Â  }

Â  Â  private void HandleClearSearch() 
Â  Â  { 
Â  Â  Â  Â  SearchService.ClearSearch(); 
Â  Â  Â  Â  _ = LoadData(); 
Â  Â  }

Â  Â  private void ToggleAdvancedSearch() 
Â  Â  { 
Â  Â  Â  Â  showAdvancedSearch = !showAdvancedSearch; 
Â  Â  }

Â  Â  private void HideAdvancedSearch() 
Â  Â  { 
Â  Â  Â  Â  showAdvancedSearch = false; 
Â  Â  }

Â  Â  private async Task HandleExecuteAdvancedSearch() 
Â  Â  { 
Â  Â  Â  Â  showAdvancedSearch = false; 
Â  Â  Â  Â  await SearchService.ExecuteSearch(userId); 
Â  Â  }

Â  Â  private void HandleSearchPrevPage()
Â  Â  {
Â  Â  Â  Â  SearchService.MoveToPrevPage();
Â  Â  }

Â  Â  private void HandleSearchNextPage()
Â  Â  {
Â  Â  Â  Â  SearchService.MoveToNextPage();
Â  Â  }

Â  Â  #endregion

Â  Â  #region Cloning Logic

Â  Â  private void HandleShowCloner()
Â  Â  {
Â  Â  Â  Â  showTemporalCloneModal = true;
Â  Â  }

Â  Â  private void HideCloner()
Â  Â  {
Â  Â  Â  Â  showTemporalCloneModal = false;
Â  Â  }

Â  Â  private async Task ExecuteClone() 
Â  Â  { 
Â  Â  Â  Â  var count = await BaseService.CloneYearlyItems(
Â  Â  Â  Â  Â  Â  userId, 
Â  Â  Â  Â  Â  Â  cloneSourceYear, 
Â  Â  Â  Â  Â  Â  cloneTargetYear, 
Â  Â  Â  Â  Â  Â  includeBirthdays, 
Â  Â  Â  Â  Â  Â  includeAnniversaries, 
Â  Â  Â  Â  Â  Â  includeHolidays
Â  Â  Â  Â  ); 

Â  Â  Â  Â  showTemporalCloneModal = false; 
Â  Â  Â  Â  
Â  Â  Â  Â  await JS.InvokeVoidAsync(
Â  Â  Â  Â  Â  Â  "alert", 
Â  Â  Â  Â  Â  Â  $"Successfully created {count} new items for {cloneTargetYear}!"
Â  Â  Â  Â  ); 
Â  Â  Â  Â  
Â  Â  Â  Â  await LoadData(); 
Â  Â  }

Â  Â  private async Task HandlePillReorder(int id) 
Â  Â  { 
Â  Â  Â  Â  var item = loadedItems.FirstOrDefault(x => x.Id == id); 
Â  Â  Â  Â  
Â  Â  Â  Â  if (item == null) 
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Â  return; 
Â  Â  Â  Â  }

Â  Â  Â  Â  await MoveItem(item, 0, false); 
Â  Â  }

Â  Â  private async Task LogToConsole(string msg) 
Â  Â  { 
Â  Â  Â  Â  await JS.InvokeVoidAsync("console.log", $"[CALENDAR] {msg}"); 
Â  Â  }

Â  Â  #endregion
}