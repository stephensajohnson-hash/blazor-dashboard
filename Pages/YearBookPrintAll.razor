@page "/year-book-print-all/{Year:int}"
@using Dashboard
@using Dashboard.Services
@using Dashboard.Components.Bullet
@using Microsoft.JSInterop
@using Microsoft.AspNetCore.Components.Web

@layout EmptyLayout
@rendermode @(new Microsoft.AspNetCore.Components.Web.InteractiveServerRenderMode(prerender: false))

@inject IJSRuntime JS

<div class="print-all-container bg-white">
    @for (int m = 1; m <= 12; m++)
    {
        @* This component now uses the logic already proven in your build *@
        <YearBookExport Year="Year" Month="m" />
    }
</div>

<style>
    .print-all-container {
        width: 100%;
        background: white;
    }
    /* Force page breaks between months for the printer */
    ::deep .print-page {
        page-break-after: always;
    }
</style>

@code {
    [Parameter] public int Year { get; set; }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            // Give the 12 months a few seconds to finish their individual database queries
            await Task.Delay(5000);
            
            // Trigger the native browser print dialog
            await JS.InvokeVoidAsync("print");
        }
    }
}