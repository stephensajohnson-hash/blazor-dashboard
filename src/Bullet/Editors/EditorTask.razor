@namespace Dashboard.Components.Bullet.Editors
@using Dashboard

<div class="grid grid-cols-2 gap-4">
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">ğŸš¨ Priority</label>
        <select @bind="Detail.Priority" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white text-sm">
            <option>Low</option><option>Normal</option><option>High</option><option>Critical</option>
        </select>
    </div>
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">ğŸ“… Due Date</label>
        <input type="date" @bind="Detail.DueDate" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white text-sm" />
    </div>
</div>
<div class="grid grid-cols-2 gap-4 mt-4">
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">ğŸ« Ticket #</label>
        <input @bind="Detail.TicketNumber" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-white text-sm" placeholder="JIRA-123" />
    </div>
    <div>
        <label class="block text-[10px] font-bold text-gray-500 uppercase mb-1">ğŸ”— Ticket URL</label>
        <input @bind="Detail.TicketUrl" class="w-full bg-gray-900 border border-gray-700 rounded px-3 py-2 text-blue-400 text-sm" placeholder="https://..." />
    </div>
</div>

<div class="flex items-center gap-3 bg-gray-900/50 p-3 rounded border border-gray-700 mt-2">
    <input type="checkbox" @bind="Detail.IsCompleted" id="chkTask" class="w-5 h-5 rounded bg-gray-800 border-gray-600 text-green-500" />
    <label for="chkTask" class="text-sm font-bold text-white cursor-pointer uppercase">âœ… Mark Master as Completed</label>
</div>

@* NEW CHECKLIST MANAGEMENT SECTION *@
<div class="mt-6 space-y-4">
    <div class="flex justify-between items-center border-b border-gray-700 pb-2">
        <label class="block text-[10px] font-bold text-blue-400 uppercase tracking-widest">ğŸ“ Checklist Items</label>
        <button @onclick="AddTodo" class="text-[10px] font-bold text-blue-400 hover:text-blue-300 uppercase">ï¼‹ Add Item</button>
    </div>

    @foreach (var todo in Todos.OrderBy(t => t.Order))
    {
        <div class="flex items-center gap-3 bg-black/20 p-2 rounded border border-gray-800 group">
            <input type="checkbox" @bind="todo.IsCompleted" class="w-4 h-4 rounded bg-gray-900 border-gray-700 accent-blue-500" />
            
            <span class="text-[10px] font-bold text-gray-500 w-4">@(todo.Order + 1).</span>
            
            <input @bind="todo.Content" class="flex-1 bg-transparent border-none text-sm text-gray-200 outline-none focus:ring-0" placeholder="Task description..." />

            <div class="flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
                <button @onclick="() => MoveUp(todo)" class="p-1 text-gray-500 hover:text-white text-xs">â–²</button>
                <button @onclick="() => MoveDown(todo)" class="p-1 text-gray-500 hover:text-white text-xs">â–¼</button>
                <button @onclick="() => RemoveTodo(todo)" class="p-1 text-gray-500 hover:text-red-500 text-xs ml-1">âœ•</button>
            </div>
        </div>
    }
</div>

@code {
    [Parameter] public BulletTaskDetail Detail { get; set; } = new();
    [Parameter] public List<BulletTaskTodoItem> Todos { get; set; } = new();

    private void AddTodo()
    {
        Todos.Add(new BulletTaskTodoItem { 
            Order = Todos.Count,
            BulletItemId = Detail.BulletItemId 
        });
    }

    private void RemoveTodo(BulletTaskTodoItem item)
    {
        Todos.Remove(item);
        Reorder();
    }

    private void MoveUp(BulletTaskTodoItem item)
    {
        var index = Todos.IndexOf(item);
        if (index > 0)
        {
            var other = Todos.OrderBy(t => t.Order).ElementAt(index - 1);
            int temp = item.Order;
            item.Order = other.Order;
            other.Order = temp;
        }
    }

    private void MoveDown(BulletTaskTodoItem item)
    {
        var index = Todos.IndexOf(item);
        if (index < Todos.Count - 1)
        {
            var other = Todos.OrderBy(t => t.Order).ElementAt(index + 1);
            int temp = item.Order;
            item.Order = other.Order;
            other.Order = temp;
        }
    }

    private void Reorder()
    {
        var sorted = Todos.OrderBy(t => t.Order).ToList();
        for (int i = 0; i < sorted.Count; i++) sorted[i].Order = i;
    }
}