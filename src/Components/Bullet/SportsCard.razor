@namespace Dashboard.Components.Bullet
@using Dashboard

<div class="bg-gray-800 border border-gray-700 rounded-lg mb-3 overflow-hidden shadow-lg group relative">
    
    <div class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition z-30">
        <button @onclick="HandleClick" class="p-1 rounded bg-gray-700 hover:bg-blue-600 text-gray-300 hover:text-white border border-gray-600 shadow-md">‚úèÔ∏è</button>
        <button @onclick="HandleDelete" class="p-1 rounded bg-gray-700 hover:bg-red-600 text-red-400 hover:text-white border border-gray-600 shadow-md">‚úï</button>
    </div>

    <div class="bg-gray-900/80 p-2 flex justify-between items-center text-[10px] uppercase font-bold text-gray-500 tracking-wider">
        <div class="flex items-center gap-2">
            @if(!string.IsNullOrEmpty(Item.League?.ImgUrl)) { <img src="@Item.League?.ImgUrl" class="w-4 h-4 object-contain" /> }
            <span>@Item.League?.Name</span>
        </div>
        <div class="@(Item.Detail.IsComplete ? "text-gray-400" : "text-green-400")">
            @(Item.Detail.IsComplete ? "Final" : (Item.Detail.StartTime?.ToString("h:mm tt") ?? "TBD"))
        </div>
    </div>

    <div class="p-3">
        <div class="flex justify-between items-center mb-3">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-black rounded-full border border-gray-700 flex items-center justify-center overflow-hidden">
                    @if(!string.IsNullOrEmpty(Item.AwayTeam?.LogoUrl)) { <img src="@Item.AwayTeam?.LogoUrl" class="w-full h-full object-cover" /> }
                    else { <span class="text-[8px] text-gray-500">@Item.AwayTeam?.Abbreviation</span> }
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-bold text-white leading-none">@Item.AwayTeam?.Name</span>
                    <span class="text-[10px] text-gray-500">@Item.AwayTeam?.Abbreviation</span>
                </div>
            </div>
            <span class="text-2xl font-bold font-mono @(Item.Detail.AwayScore > Item.Detail.HomeScore ? "text-white" : "text-gray-500")">
                @Item.Detail.AwayScore
            </span>
        </div>

        <div class="flex justify-between items-center">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-black rounded-full border border-gray-700 flex items-center justify-center overflow-hidden">
                    @if(!string.IsNullOrEmpty(Item.HomeTeam?.LogoUrl)) { <img src="@Item.HomeTeam?.LogoUrl" class="w-full h-full object-cover" /> }
                    else { <span class="text-[8px] text-gray-500">@Item.HomeTeam?.Abbreviation</span> }
                </div>
                <div class="flex flex-col">
                    <span class="text-sm font-bold text-white leading-none">@Item.HomeTeam?.Name</span>
                    <span class="text-[10px] text-gray-500">@Item.HomeTeam?.Abbreviation</span>
                </div>
            </div>
            <span class="text-2xl font-bold font-mono @(Item.Detail.HomeScore > Item.Detail.AwayScore ? "text-white" : "text-gray-500")">
                @Item.Detail.HomeScore
            </span>
        </div>
    </div>

    @if(!string.IsNullOrEmpty(Item.Detail.TvChannel) || Item.Season != null)
    {
        <div class="px-3 py-1 bg-gray-900/50 border-t border-gray-700 flex justify-between text-[10px] text-gray-500">
            <span>@Item.Season?.Name</span>
            @if(!string.IsNullOrEmpty(Item.Detail.TvChannel)) { <span class="text-blue-400">üì∫ @Item.Detail.TvChannel</span> }
        </div>
    }
</div>

@code {
    [Parameter] public BulletSportsService.GameDTO Item { get; set; } = new();
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }

    // Convert GameDTO to TaskDTO for compatibility with parent handler
    private async Task HandleClick() 
    {
        var taskDto = new BulletTaskService.TaskDTO 
        { 
            Id = Item.Id, UserId = Item.UserId, Type = "sports", Date = Item.Date, Title = Item.Title,
            // Pack the detail into a generic object or handle in parent if possible
            // For now, simpler to just invoke and let parent re-fetch
        };
        await OnClick.InvokeAsync(taskDto); 
    }
    private async Task HandleDelete() => await OnDelete.InvokeAsync(Item.Id);
}