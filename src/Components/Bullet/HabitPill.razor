@namespace Dashboard.Components.Bullet
@using Dashboard

<div class="bg-cyan-800 border border-cyan-600 hover:bg-cyan-700 rounded mb-1 overflow-hidden cursor-pointer transition flex group shadow-sm relative pr-6 @((Item?.HabitDetail?.IsCompleted ?? false) ? "opacity-60" : "opacity-100") @(Item?.HabitDetail?.Status == "Skipped" ? "grayscale-[0.8] !bg-gray-800 border-orange-900/50" : "")" @onclick="HandleClick">
    
    @* MINI STAMP *@
    @if (Item?.HabitDetail?.Status == "Skipped")
    {
        <div class="absolute inset-0 flex items-center justify-center pointer-events-none z-10 overflow-hidden">
            <div class="border border-orange-500/40 text-orange-500/40 text-[10px] font-black px-1.5 py-0 uppercase rotate-[-10deg] scale-150 tracking-tighter bg-black/10">
                Skipped
            </div>
        </div>
    }

    <div class="absolute right-0 top-0 bottom-0 w-5 flex flex-col opacity-0 group-hover:opacity-100 transition z-20 bg-black/20 backdrop-blur-sm border-l border-white/10">
        <button @onclick="MoveUp" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">‚ñ≤</button>
        <button @onclick="MoveDown" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">‚ñº</button>
    </div>

    @if(!string.IsNullOrEmpty(Item.ImgUrl))
    {
        <div class="relative bg-black shrink-0" style="width: @ImageWidth;">
            <img src="@Item.ImgUrl" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition" />
        </div>
    }

    <div class="p-1 flex-1 min-w-0 flex items-center">
        <div class="truncate text-[10px] text-white transition w-full font-sans font-black">
            
            @if (Item?.HabitDetail?.Status == "Skipped")
            {
                <span class="mr-1 text-orange-700 font-black">‚è≠Ô∏è</span> 
                <span class="text-gray-500 italic">@Item.Title</span>
            }
            else if (Item?.HabitDetail?.IsCompleted == true)
            {
                <span class="mr-1 text-cyan-200 font-bold font-black">üî• @(Item.HabitDetail.StreakCount)</span> 
                <span class="line-through text-cyan-200/70 font-black">@Item.Title</span>
            }
            else
            {
                <span class="mr-1 text-yellow-400 font-bold font-black">‚è≥</span>
                <span class="font-black">@Item.Title</span>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public BulletTaskService.TaskDTO Item { get; set; } = new();
    
    [Parameter] public string ImageWidth { get; set; } = "20%";
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<int> OnMoveUp { get; set; }
    [Parameter] public EventCallback<int> OnMoveDown { get; set; }

    private async Task HandleClick() => await OnClick.InvokeAsync(Item);
    private async Task MoveUp() => await OnMoveUp.InvokeAsync(Item.Id);
    private async Task MoveDown() => await OnMoveDown.InvokeAsync(Item.Id);
}