@namespace Dashboard.Components.Bullet
@using Dashboard
@using Microsoft.AspNetCore.Components.Web

<div class="bg-gray-900 border border-gray-700 rounded-lg p-0 relative group hover:border-blue-500 transition shadow-sm overflow-hidden mb-2 flex">
    
    <div class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition z-10">
        <button @onclick="HandleClick" @onclick:stopPropagation="true" class="p-1 rounded bg-gray-800 hover:bg-blue-600 text-gray-400 hover:text-white transition shadow-md" title="Edit">
            ✏️
        </button>
        <button @onclick="HandleDelete" @onclick:stopPropagation="true" class="p-1 rounded bg-gray-800 hover:bg-red-600 text-red-400 hover:text-white transition shadow-md" title="Delete">
            ❌
        </button>
    </div>

    @if(!string.IsNullOrEmpty(Task.ImgUrl)) {
        <div class="relative bg-black shrink-0 cursor-pointer" style="width: @BulletViewConfig.ImgWidthDay;" @onclick="HandleClick">
            <img src="@Task.ImgUrl" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition" />
        </div>
    }
    
    <div class="p-3 flex-1 min-w-0 cursor-pointer" @onclick="HandleClick">
        <div class="flex items-start gap-3">
            <input type="checkbox" checked="@Task.Detail.IsCompleted" 
                   @onchange="HandleToggle" 
                   @onclick:stopPropagation="true"
                   class="mt-1 w-4 h-4 rounded bg-gray-800 border-gray-600 shrink-0 cursor-pointer" />
            
            <div class="flex-1 min-w-0">
                <h4 class="text-sm font-bold text-white leading-tight @(Task.Detail.IsCompleted ? "line-through text-gray-500" : "")">
                    @Task.Title
                </h4>
                
                @if(!string.IsNullOrEmpty(Task.Description)) { 
                    <p class="text-xs text-gray-500 mt-1 line-clamp-2">@Task.Description</p> 
                }
                
                <div class="flex gap-2 mt-2">
                    @if(!string.IsNullOrEmpty(Task.Detail.TicketNumber)) { 
                        <span class="text-[9px] bg-blue-900/30 text-blue-300 border border-blue-800 px-1.5 py-0.5 rounded uppercase tracking-wider">
                            @Task.Detail.TicketNumber
                        </span> 
                    }
                    @if(Task.Detail.Priority == "High") { 
                        <span class="text-[9px] bg-red-900/30 text-red-300 border border-red-800 px-1.5 py-0.5 rounded uppercase tracking-wider">
                            High
                        </span> 
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public BulletTaskService.TaskDTO Task { get; set; } = new();
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnToggle { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }

    private async Task HandleClick() => await OnClick.InvokeAsync(Task);
    private async Task HandleToggle() => await OnToggle.InvokeAsync(Task);
    private async Task HandleDelete() => await OnDelete.InvokeAsync(Task.Id);
}