@namespace Dashboard.Components.Bullet
@using Dashboard

<div class="bg-emerald-900/40 border border-emerald-600 hover:border-white rounded mb-1 overflow-hidden cursor-pointer transition flex group relative pr-6 shadow-sm" @onclick="HandleClick">
    
    <div class="absolute right-0 top-0 bottom-0 w-5 flex flex-col opacity-0 group-hover:opacity-100 transition z-20 bg-black/20 backdrop-blur-sm border-l border-white/10">
        <button @onclick="MoveUp" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">‚ñ≤</button>
        <button @onclick="MoveDown" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">‚ñº</button>
    </div>

    @{
        var net = Item.Meals.Sum(m => m.Calories) - Item.Workouts.Sum(w => w.CaloriesBurned);
    }

    <div class="p-1 flex-1 min-w-0 flex items-center justify-between">
        <div class="truncate text-[10px] text-emerald-100 group-hover:text-white transition font-sans font-bold flex gap-2">
            <span>üçè Health</span>
            @if(Item.HealthDetail.WeightLbs > 0) { <span class="text-emerald-400">@Item.HealthDetail.WeightLbs lbs</span> }
        </div>
        <div class="text-[9px] font-mono text-gray-400">
            @Math.Round(net) cal
        </div>
    </div>
</div>

@code {
    [Parameter] public BulletTaskService.TaskDTO Item { get; set; } = new();
    [Parameter] public string ImageWidth { get; set; } = "20%"; // Not used, keeping for interface consistency
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<int> OnMoveUp { get; set; }
    [Parameter] public EventCallback<int> OnMoveDown { get; set; }

    private async Task HandleClick() => await OnClick.InvokeAsync(Item);
    private async Task MoveUp() => await OnMoveUp.InvokeAsync(Item.Id);
    private async Task MoveDown() => await OnMoveDown.InvokeAsync(Item.Id);
}