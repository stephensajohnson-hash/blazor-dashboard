@namespace Dashboard.Components.Bullet
@using Dashboard

<BaseItemCard Item="Item" Notes="Item.Notes" IsCompleted="Item.MeetingDetail.IsCompleted" 
              BorderClass="border-purple-900 hover:border-purple-500"
              OnEdit="HandleClick" OnDelete="HandleDelete" OnToggle="HandleToggle">
    <ChildContent>
        <span class="text-[10px] bg-purple-900/40 text-purple-300 border border-purple-700 px-1.5 py-0.5 rounded font-mono">
            @(Item.MeetingDetail.StartTime?.ToString("h:mm tt") ?? "TBD")
            @if(Item.MeetingDetail.DurationMinutes > 0) { <span> (@Item.MeetingDetail.DurationMinutes m)</span> }
        </span>
    </ChildContent>
</BaseItemCard>

@code {
    // UPDATED: Now accepts the generic TaskDTO wrapper
    [Parameter] public BulletTaskService.TaskDTO Item { get; set; } = new();
    
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnToggle { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }

    private async Task HandleClick() => await OnClick.InvokeAsync(Item);
    private async Task HandleDelete() => await OnDelete.InvokeAsync(Item.Id);
    
    private async Task HandleToggle(bool val) {
        Item.MeetingDetail.IsCompleted = val;
        await OnToggle.InvokeAsync(Item);
    }
}