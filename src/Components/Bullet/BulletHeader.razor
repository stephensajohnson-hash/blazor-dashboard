@namespace Dashboard.Components.Bullet
@inject NavigationManager Nav
@inject IJSRuntime JS

<header class="flex flex-row justify-between items-center bg-gray-800 p-3 shadow-md border-b border-gray-700 mb-4">
    <div class="flex items-center gap-2">
        <button @onclick='() => Nav.NavigateTo("/dashboard")' 
                class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition">
            Dashboard
        </button>
        <button @onclick='() => Nav.NavigateTo("/recipes")' 
                class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition">
            Recipes
        </button>
        <button @onclick='() => Nav.NavigateTo("/bullet_calendar")' 
                class="px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded text-sm font-bold transition">
            Bullet Calendar
        </button>
    </div>

    <div class="flex flex-col items-center">
        <div class="text-white font-bold text-lg tracking-wide">
            @DateTime.Now.ToString("dddd, MMMM d, yyyy")
        </div>

        <div class="flex items-center gap-2 text-sm text-gray-400 mt-1">
            <button @onclick='() => GoToCalendar("day", true)' class="hover:text-white hover:underline">Today</button>
            <span>|</span>
            <button @onclick='() => GoToCalendar("day", false)' class="hover:text-white hover:underline">Day</button>
            <span>|</span>
            <button @onclick='() => GoToCalendar("week", false)' class="hover:text-white hover:underline">Week</button>
            <span>|</span>
            <button @onclick='() => GoToCalendar("month", false)' class="hover:text-white hover:underline">Month</button>
        </div>
    </div>

    <div class="relative">
        <div class="cursor-pointer" @onclick="ToggleUserMenu">
            <img src="/images/avatar.png" alt="User" class="w-10 h-10 rounded-full border-2 border-gray-600 hover:border-white transition" />
        </div>

        @if (showUserMenu)
        {
            <div class="absolute right-0 mt-2 w-48 bg-gray-800 border border-gray-700 rounded-lg shadow-xl z-50 overflow-hidden">
                <a href="/settings" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Settings</a>
                <a href="/manage_sports" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Manage Sports</a>
                <a href="/movies" class="block px-4 py-2 text-sm text-gray-300 hover:bg-gray-700 hover:text-white">Movies</a>
                <div class="border-t border-gray-700 my-1"></div>
                <button @onclick="Logout" class="block w-full text-left px-4 py-2 text-sm text-red-400 hover:bg-gray-700 hover:text-red-300">
                    Log Out
                </button>
            </div>
        }
    </div>
</header>

@code {
    private bool showUserMenu = false;

    private void ToggleUserMenu()
    {
        showUserMenu = !showUserMenu;
    }

    private void GoToCalendar(string viewType, bool isToday)
    {
        // Construct the URL with query parameters
        var url = $"/bullet_calendar?view={viewType}";
        
        if (isToday)
        {
            var todayStr = DateTime.Now.ToString("yyyy-MM-dd");
            url += $"&date={todayStr}";
        }

        Nav.NavigateTo(url);
    }

    private void Logout()
    {
        // Simple redirect for now
        Nav.NavigateTo("/");
    }
}