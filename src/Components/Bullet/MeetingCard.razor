@namespace Dashboard.Components.Bullet
@using Dashboard

<div class="bg-gray-800 border border-gray-700 rounded-lg mb-3 overflow-hidden shadow-lg group relative transition hover:border-purple-500/50">
    <div class="absolute top-1 right-1 flex gap-1 opacity-0 group-hover:opacity-100 transition z-20">
        <button @onclick="HandleClick" class="p-1 rounded bg-gray-700 hover:bg-blue-600 text-gray-300 hover:text-white border border-gray-600 shadow-md">‚úèÔ∏è</button>
        <button @onclick="HandleDelete" class="p-1 rounded bg-gray-700 hover:bg-red-600 text-red-400 hover:text-white border border-gray-600 shadow-md">‚úï</button>
    </div>

    @if(!string.IsNullOrEmpty(Item.ImgUrl))
    {
        <div class="h-24 w-full bg-black relative">
            <img src="@Item.ImgUrl" class="w-full h-full object-cover opacity-80" />
            <div class="absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t from-gray-900 to-transparent"></div>
        </div>
    }

    <div class="p-3 relative">
        <div class="flex justify-between items-start mb-2">
            <div class="flex items-center gap-2 text-[10px] uppercase font-bold text-purple-400 tracking-wider">
                <span>üìÖ Meeting</span>
                <span>@Item.MeetingDetail?.StartTime?.ToString("h:mm tt")</span>
            </div>
            
            <input type="checkbox" checked="@(Item.MeetingDetail?.IsCompleted ?? false)" @onchange="ToggleComplete" class="w-4 h-4 rounded border-gray-600 bg-gray-700 text-purple-500 focus:ring-0 cursor-pointer z-10" />
        </div>

        <h3 class="font-bold text-white text-sm mb-1 leading-snug @((Item.MeetingDetail?.IsCompleted ?? false) ? "line-through text-gray-500" : "")">
            @Item.Title
        </h3>

        @if(!string.IsNullOrEmpty(Item.Description))
        {
            <p class="text-xs text-gray-400 mb-2 line-clamp-2">@Item.Description</p>
        }

        <div class="flex items-center gap-3 text-xs text-gray-500 mt-2 border-t border-gray-700/50 pt-2">
            <span class="flex items-center gap-1">‚è± @(Item.MeetingDetail?.DurationMinutes ?? 0) min</span>
            @if((Item.MeetingDetail?.ActualDurationMinutes ?? 0) > 0)
            {
                <span class="flex items-center gap-1 text-yellow-500 font-bold">‚úÖ @Item.MeetingDetail?.ActualDurationMinutes min</span>
            }
        </div>
    </div>
</div>

@code {
    [Parameter] public BulletTaskService.TaskDTO Item { get; set; } = new();
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnToggle { get; set; }
    [Parameter] public EventCallback<int> OnDelete { get; set; }

    private async Task ToggleComplete(ChangeEventArgs e) 
    { 
        await OnToggle.InvokeAsync(Item); 
    }
    
    private async Task HandleClick() => await OnClick.InvokeAsync(Item);
    private async Task HandleDelete() => await OnDelete.InvokeAsync(Item.Id);
}