@namespace Dashboard.Components.Bullet
@using Dashboard

<div class="@GetClasses() rounded mb-1 overflow-hidden cursor-pointer border transition flex group relative pr-6" @onclick="HandleClick">
    
    <div class="absolute right-0 top-0 bottom-0 w-5 flex flex-col opacity-0 group-hover:opacity-100 transition z-20 bg-black/20 backdrop-blur-sm border-l border-white/10">
        <button @onclick="MoveUp" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">▲</button>
        <button @onclick="MoveDown" @onclick:stopPropagation="true" class="flex-1 hover:bg-white/20 text-[8px] flex items-center justify-center text-white leading-none">▼</button>
    </div>

    @if(!string.IsNullOrEmpty(Task.ImgUrl))
    {
        <div class="relative bg-black shrink-0" style="width: @ImageWidth;">
            <img src="@Task.ImgUrl" class="w-full h-full object-cover opacity-80 group-hover:opacity-100 transition" />
        </div>
    }

    <div class="p-1 flex-1 min-w-0 flex items-center">
        <div class="truncate text-[10px] text-gray-200 group-hover:text-white transition w-full">
            @if(Task.Detail.IsCompleted) { <span class="text-green-400 font-bold mr-1">✓</span> }
            <span class="@(Task.Detail.IsCompleted ? "line-through text-gray-500" : "")">
                @Task.Title
            </span>
        </div>
    </div>
</div>

@code {
    [Parameter] public BulletTaskService.TaskDTO Task { get; set; } = new();
    [Parameter] public string ImageWidth { get; set; } = "20%";
    [Parameter] public EventCallback<BulletTaskService.TaskDTO> OnClick { get; set; }
    [Parameter] public EventCallback<int> OnMoveUp { get; set; }
    [Parameter] public EventCallback<int> OnMoveDown { get; set; }

    private async Task HandleClick() => await OnClick.InvokeAsync(Task);
    private async Task MoveUp() => await OnMoveUp.InvokeAsync(Task.Id);
    private async Task MoveDown() => await OnMoveDown.InvokeAsync(Task.Id);

    private string GetClasses() 
    {
        if (Task.Detail.IsCompleted) return "bg-gray-900 border-gray-800 opacity-60 hover:opacity-100";
        return "bg-gray-800 border-gray-700 hover:border-blue-500";
    }
}